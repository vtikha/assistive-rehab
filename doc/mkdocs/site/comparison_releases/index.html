



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A framework for developing the assistive intelligence of R1 for clinical rehabilitation.">
      
      
        <link rel="canonical" href="https://github.com/robotology/assistive-rehab/comparison_releases/">
      
      
        <meta name="author" content="Valentina vasco">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Comparison between Y1Q3 and Y1M5 - assistive-rehab</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.01803549.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="" data-md-color-accent="amber">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#comparison-between-y1q3-and-y1m5" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://github.com/robotology/assistive-rehab" title="assistive-rehab" class="md-header-nav__button md-logo">
          
            <i class="md-icon">dashboard</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              assistive-rehab
            </span>
            <span class="md-header-nav__topic">
              
                Comparison between Y1Q3 and Y1M5
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/robotology/assistive-rehab/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    robotology/assistive-rehab
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../latest_news/" title="News" class="md-tabs__link">
          News
        </a>
      
    </li>
  

      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../tutorial_intro/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../Y1M5/" title="Milestones" class="md-tabs__link md-tabs__link--active">
          Milestones
        </a>
      
    </li>
  

      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://github.com/robotology/assistive-rehab" title="assistive-rehab" class="md-nav__button md-logo">
      
        <i class="md-icon">dashboard</i>
      
    </a>
    assistive-rehab
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/robotology/assistive-rehab/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    robotology/assistive-rehab
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      News
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        News
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../latest_news/" title="Latest" class="md-nav__link">
      Latest
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../install/" title="Install" class="md-nav__link">
      Install
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://robotology.github.io/assistive-rehab/doc/doxygen/doc/html/index.html" title="Documentation [v0.4.0]" class="md-nav__link">
      Documentation [v0.4.0]
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial_intro/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../create_new_skeleton/" title="How to manage a skeleton object" class="md-nav__link">
      How to manage a skeleton object
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../replay_an_experiment/" title="How to replay an experiment" class="md-nav__link">
      How to replay an experiment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../disembodied/" title="How to run the pipeline in a disembodied manner" class="md-nav__link">
      How to run the pipeline in a disembodied manner
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../align_signals/" title="How to temporally align two signals" class="md-nav__link">
      How to temporally align two signals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../main_apps/" title="How to run the main applications" class="md-nav__link">
      How to run the main applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../virtual_demo/" title="How to run the virtual demo" class="md-nav__link">
      How to run the virtual demo
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Milestones
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Milestones
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Y1M5/" title="Y1M5" class="md-nav__link">
      Y1M5
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Y1Q3/" title="Y1Q3" class="md-nav__link">
      Y1Q3
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Comparison between Y1Q3 and Y1M5
      </label>
    
    <a href="./" title="Comparison between Y1Q3 and Y1M5" class="md-nav__link md-nav__link--active">
      Comparison between Y1Q3 and Y1M5
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#acquisition" title="Acquisition" class="md-nav__link">
    Acquisition
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filtering-the-disparity-map" title="Filtering the disparity map" class="md-nav__link">
    Filtering the disparity map
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimizing-the-skeleton" title="Optimizing the skeleton" class="md-nav__link">
    Optimizing the skeleton
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reducing-latencies" title="Reducing latencies" class="md-nav__link">
    Reducing latencies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extending-the-feedback" title="Extending the feedback" class="md-nav__link">
    Extending the feedback
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#y1m5" title="Y1M5" class="md-nav__link">
    Y1M5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#y1q3" title="Y1Q3" class="md-nav__link">
    Y1Q3
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#action-recognition" title="Action Recognition" class="md-nav__link">
    Action Recognition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#joint-analysis" title="Joint analysis" class="md-nav__link">
    Joint analysis
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#range-of-motion-exercises" title="Range of Motion exercises" class="md-nav__link">
    Range of Motion exercises
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reaching" title="Reaching" class="md-nav__link">
    Reaching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comparison" title="Comparison" class="md-nav__link">
    Comparison
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#acquisition" title="Acquisition" class="md-nav__link">
    Acquisition
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filtering-the-disparity-map" title="Filtering the disparity map" class="md-nav__link">
    Filtering the disparity map
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimizing-the-skeleton" title="Optimizing the skeleton" class="md-nav__link">
    Optimizing the skeleton
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reducing-latencies" title="Reducing latencies" class="md-nav__link">
    Reducing latencies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extending-the-feedback" title="Extending the feedback" class="md-nav__link">
    Extending the feedback
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#y1m5" title="Y1M5" class="md-nav__link">
    Y1M5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#y1q3" title="Y1Q3" class="md-nav__link">
    Y1Q3
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#action-recognition" title="Action Recognition" class="md-nav__link">
    Action Recognition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#joint-analysis" title="Joint analysis" class="md-nav__link">
    Joint analysis
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#range-of-motion-exercises" title="Range of Motion exercises" class="md-nav__link">
    Range of Motion exercises
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reaching" title="Reaching" class="md-nav__link">
    Reaching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comparison" title="Comparison" class="md-nav__link">
    Comparison
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/robotology/assistive-rehab/edit/master/doc/mkdocs/data/comparison_releases.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="comparison-between-y1q3-and-y1m5">Comparison between <a href="../Y1Q3/">Y1Q3</a> and <a href="../Y1M5/">Y1M5</a><a class="headerlink" href="#comparison-between-y1q3-and-y1m5" title="Permanent link">&para;</a></h1>
<h2 id="acquisition">Acquisition<a class="headerlink" href="#acquisition" title="Permanent link">&para;</a></h2>
<p>The improvements that Y1Q3 introduces in terms of acquisition are listed below:</p>
<ol>
<li><a href="#filtering-the-disparity-map">Filtering the disparity map</a>;</li>
<li><a href="#optimizing-the-skeleton">Optimizing the skeleton</a>;</li>
<li><a href="#reducing-latencies">Reducing latencies</a>.</li>
</ol>
<h3 id="filtering-the-disparity-map">Filtering the disparity map<a class="headerlink" href="#filtering-the-disparity-map" title="Permanent link">&para;</a></h3>
<p>The disparity map provided by the camera is inaccurate around the human contour and might have holes, leading keypoints close to the contour (e.g. hands) or on an hole to be projected incorrectly. For example, the following video shows the depth map for an abduction movement, where the hand is projected to infinite:</p>
<p align="center">
<img src="https://user-images.githubusercontent.com/9716288/49949881-063f7780-fef7-11e8-935e-43c4d8cf9dab.gif" width="500">
</p>

<p>In Y1M5, the disparity map is used as provided by the camera, without any additional processing, and thus it is affected by the effect described. In Y1Q3, the disparity map is eroded (and thus the depth map dilated), which has the double effect of:</p>
<ol>
<li>increasing the probability for keypoints closer to the contour to fall within the correct depth map;</li>
<li>filling holes in the depth.</li>
</ol>
<p>The following video shows the effect of filtering the depth map and keypoints falling within the correct depth:</p>
<table>
<thead>
<tr>
<th>Unprocessed depth (Y1M5)</th>
<th>Filtered depth (Y1Q3)</th>
<th>Keypoints inside the depth</th>
</tr>
</thead>
<tbody>
<tr>
<td><p align="center"> <img src=https://user-images.githubusercontent.com/9716288/50230577-31b9da80-03ad-11e9-9460-53fbf7bcef76.gif width="250"> </p></td>
<td><p align="center">  <img src=https://user-images.githubusercontent.com/9716288/50230653-5dd55b80-03ad-11e9-84db-b0b8693659fd.gif width="250"> </p></td>
<td><p align="center">  <img src=https://user-images.githubusercontent.com/9716288/50230688-72195880-03ad-11e9-87ed-3a981c12cbee.gif width="250"> </p></td>
</tr>
</tbody>
</table>
<h3 id="optimizing-the-skeleton">Optimizing the skeleton<a class="headerlink" href="#optimizing-the-skeleton" title="Permanent link">&para;</a></h3>
<p>Exercises that require movements parallel to the optical axis make some keypoints ambiguous. For example, in the external and internal rotation, the elbow is not directly observable as the hand occludes it. Therefore both keypoints are projected to the same depth, as shown here:</p>
<table>
<thead>
<tr>
<th>Without optimization (Y1M5)</th>
</tr>
</thead>
<tbody>
<tr>
<td><p align="center"> <img src=https://user-images.githubusercontent.com/9716288/49950004-3a1a9d00-fef7-11e8-8657-98e1802c2dde.gif width="750"> </p></td>
</tr>
</tbody>
</table>
<p>In Y1Q3, we introduce an optimization of the skeleton, which adjusts the depth of the keypoints such that the length of the arms is equal to that observed during an initial phase. The following image shows the result of the optimization, in which elbow and hand are projected correctly.</p>
<table>
<thead>
<tr>
<th>With optimization (Y1Q3)</th>
</tr>
</thead>
<tbody>
<tr>
<td><p align="center"> <img src=https://user-images.githubusercontent.com/9716288/49950012-4272d800-fef7-11e8-8bbe-8ff08a453f1d.gif  width="750"> </p></td>
</tr>
</tbody>
</table>
<h3 id="reducing-latencies">Reducing latencies<a class="headerlink" href="#reducing-latencies" title="Permanent link">&para;</a></h3>
<p><code>yarpOpenPose</code> introduces a visible latency in the depth map, as shown here:</p>
<table>
<thead>
<tr>
<th>Without <code>yarpOpenPose</code></th>
<th>With <code>yarpOpenPose</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><p align="center"> <img src=https://user-images.githubusercontent.com/9716288/49950278-ca58e200-fef7-11e8-88b1-0256162843f8.gif width="350" height=332> </p></td>
<td><p align="center"> <img src=https://user-images.githubusercontent.com/9716288/49950123-7e0da200-fef7-11e8-8a4a-e14eb6477cd3.gif  width="340" height=332> </p></td>
</tr>
</tbody>
</table>
<p>In Y1Q3, <code>yarpOpenPose</code> propagates the depth image in sync with the output of skeleton detection, in order to equalize the delay between the two streams.</p>
<h2 id="extending-the-feedback">Extending the feedback<a class="headerlink" href="#extending-the-feedback" title="Permanent link">&para;</a></h2>
<h3 id="y1m5">Y1M5<a class="headerlink" href="#y1m5" title="Permanent link">&para;</a></h3>
<p>In Y1M5, the feedback is based on the definition of <em>dynamic</em> joints (i.e. joints performing the exercise (1)) and <em>static</em> joints (i.e. joints staying in the initial position (2)):</p>
<ol>
<li>dynamic joints contribute to the <em>dynamic</em> score, which computes their range of motion in a predefined temporal window, by awarding joints moving within the correct range of motion;</li>
<li>static joints contribute to the <em>static</em> score, which computes their deviation from a predefined resting position.</li>
</ol>
<p>Dynamic and static scores are combined to produce three levels:</p>
<ol>
<li>
<p>low: both dynamic and static scores are low, producing the following feedback:</p>
<blockquote>
<p>"You are not moving very well!"</p>
</blockquote>
</li>
<li>
<p>medium: either dynamic or static score is medium, producing the following feedback:</p>
<blockquote>
<p>"You are doing the exercise correctly, but you could do it better."</p>
</blockquote>
</li>
<li>
<p>high: both dynamic and static scores are high, producing the following feedback:</p>
<blockquote>
<p>"You are moving very well!"</p>
</blockquote>
</li>
</ol>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<ul>
<li>the feedback does not provide a real correction of the movement;</li>
<li>the <em>speed</em> of the movement is not directly taken into account;</li>
<li>the feedback can be positive even when a wrong movement is performed (for example, a different movement with the same moving joints as external rotation instead of internal and viceversa, or a random movement with dynamic joints moving within the range of motion and static joints not deviating enough from the resting position).</li>
</ul>
</div>
<h3 id="y1q3">Y1Q3<a class="headerlink" href="#y1q3" title="Permanent link">&para;</a></h3>
<p>To overcome the drawbacks of Y1M5, in Y1Q3 the concept of dynamic and static joints is removed and the exercise is treated in its entirety as an action. Therefore the feedback is produced based on the following two layers:</p>
<ol>
<li><a href="#action-recognition">Action recognition</a>: which classifies the exercise and triggers the second layer if the predicted class equals the label of the exercise to perform. Otherwise the feedback produced is negative. This layer is fundamental as it guarantees a random or a wrong movement to not produce a positive feedback.</li>
<li><a href="#joint-analysis">Joint analysis</a>: which compares the observed skeleton with a predefined template for that movement, differently based on the exercise. The comparison with a template skeleton allows us to analyze also the speed of the movement.</li>
</ol>
<p>With this architecture, the feedback is extended and articulated in the following levels:</p>
<ul>
<li>
<p>positive feedback:</p>
<blockquote>
<p>"You are moving very well!"</p>
</blockquote>
</li>
<li>
<p>feedback for range of motion exercises:</p>
<ol>
<li>
<p>feedback on the speed:</p>
<blockquote>
<p>"Move the arm faster/slower!"</p>
</blockquote>
</li>
<li>
<p>feedback on the range of motion:</p>
<blockquote>
<p>"Move the arm further up/down!"</p>
</blockquote>
</li>
</ol>
</li>
<li>
<p>feedback for reaching exercises:</p>
<blockquote>
<p>"You are not reaching the target!"</p>
</blockquote>
</li>
<li>
<p>negative feedback:</p>
<blockquote>
<p>"You are doing the wrong exercise. Please, repeat the movements I show you."</p>
</blockquote>
</li>
</ul>
<h4 id="action-recognition">Action Recognition<a class="headerlink" href="#action-recognition" title="Permanent link">&para;</a></h4>
<p>The action recognition is carried out using a <a href="https://github.com/stuarteiffert/RNN-for-Human-Activity-Recognition-using-2D-Pose-Input">Recurrent Neural Network (RNN) with Long Short-Term Memory (LSTM) cells</a>.</p>
<ul>
<li>
<p><strong>Input to the network</strong>:
<em>2D joints</em> of the upper body from the <code>skeletonRetriever</code>. The output of the <code>skeletonRetriever</code> is preferable to that of <code>yarpOpenPose</code>, as the <code>skeletonRetriever</code> unambiguously identifies a skeleton by tag, avoiding ambiguities due to the presence of several skeletons.</p>
</li>
<li>
<p><strong>Preprocessing</strong>:
The following operations are applied to the skeleton:</p>
<ol>
<li>normalization, such that the length of each segment is 1. This prevents having different results for different physiques;</li>
<li>rototranslation, derived by the first observed skeleton;</li>
<li>scale by a factor of 10, in order to have values between -1.0,1.0.</li>
</ol>
</li>
<li>
<p><strong>Training set</strong>:
1 subject performs the following 6 exercises (i.e. 6 classes):</p>
<ol>
<li><code>abduction-left</code>;</li>
<li><code>internal-rotation-left</code>;</li>
<li><code>external-rotation-left</code>;</li>
<li><code>reaching-left</code>;</li>
<li><code>static</code> (the subject remains steady);</li>
<li><code>random</code> (the subject moves randomly).</li>
</ol>
<p>The first 3 movements are repeated 10 times and the full exercise repeated 5 times.
For the 4<sup>th</sup> movement, 4 targets to be reached are defined, distributed on the corners/center of a square, centered around the <code>shoulderLeft</code> of the subject. Each dataset was recorded from a frontal and a side view and can be found at this <a href="https://github.com/robotology/assistive-rehab-storage/tree/master/dataset-action-2">link</a>.
Parameters used for training are the following:</p>
<ol>
<li><code>n_hidden</code> = 22</li>
<li><code>n_steps</code> (temporal window) = 30</li>
<li><code>learning_rate</code> = 0.0005</li>
<li><code>batch_size</code> = 256</li>
<li><code>epochs</code> = 400</li>
</ol>
</li>
<li>
<p><strong>Validation set:</strong>
The same subject, but previously unseen data, were used for testing the network.</p>
</li>
<li>
<p><strong>Accuracy:</strong>
We get an accuracy of 92.2% with the following confusion matrix:</p>
</li>
</ul>
<p align="center">
<img src=https://user-images.githubusercontent.com/9716288/49951737-ead66b80-fefa-11e8-831e-5fe666bf2bee.png width="650">
</p>

<h4 id="joint-analysis">Joint analysis<a class="headerlink" href="#joint-analysis" title="Permanent link">&para;</a></h4>
<p>This analysis is differentiated according to the exercises, which are classified as:</p>
<ol>
<li>range of motion exercises (i.e. abduction, internal and external rotation);</li>
<li>reaching exercises.</li>
</ol>
<h5 id="range-of-motion-exercises">Range of Motion exercises<a class="headerlink" href="#range-of-motion-exercises" title="Permanent link">&para;</a></h5>
<p>The joints under analysis for these movements are: <code>elbowLeft</code>, <code>handLeft</code>.
These movements can produce two feedbacks, i.e. on the speed and on the range of motion. The feedback is provided according to a predefined hierarchy which prioritizes the speed, followed by the range of motion. Therefore, a positive feedback is produced only when both checks are fine.</p>
<ol>
<li><strong>Speed: Fourier analysis</strong></li>
</ol>
<p>We perform the Fourier transform of each component of the joints under analysis in a predefined temporal window, for both the observed and the template skeleton.
The difference in frequency is computed as <code>df = f_skeleton - f_template</code> and thus we can have two possible cases:</p>
<ol>
<li><code>df &gt; 0</code> =&gt; feedback: "Move the arm faster"</li>
<li>
<p><code>df &lt; 0</code> =&gt; feedback: "Move the arm slower"</p>
</li>
<li>
<p><strong>Range of motion: Dynamic Time Warping (DTW) plus error statistical analysis</strong></p>
</li>
</ol>
<p>The DTW is applied to each component of the joints under analysis, for both the observed and the template skeleton, allowing us to temporally align the signals to compare.
Once joints are aligned, the error between the observed and template joints under analysis is computed.       <br />
A statistical analysis is carried out, which looks for tails in the error distribution. Tails can be identified using the skewness of the distribution.
Three cases can be identified:</p>
<ol>
<li>the skeleton and the template are moving similarly. Therefore the error in position is close to 0, generating a distribution centered around 0 (i.e. with low skewness):</li>
<li>the skeleton has an higher range of motion than the template. Therefore the error will be positive, generating a distribution with a positive tail (i.e. with a positive skewness):</li>
<li>the skeleton has a lower range of motion than the template. Therefore the error will be negative, generating a distribution with a negative tail (i.e. with a negative skewness):</li>
</ol>
<h5 id="reaching">Reaching<a class="headerlink" href="#reaching" title="Permanent link">&para;</a></h5>
<p>The joint under analysis for this movement is <code>handLeft</code>.
This movement produces a feedback related to how well a predefined target is reached.</p>
<ol>
<li><strong>Statistical analysis of the reached target</strong></li>
</ol>
<p>We define a sphere around the predefined target and consider the points of the template which fall within the sphere. Statistics of the distribution of the template points are extracted to describe how the points should be distributed around the target. We then compute the number of points of the observed skeleton which fall within the template distribution. If the number of inliers is above a predefined threshold, the target is considered reached and a positive feedback is produced, otherwise the target is considered not reached.</p>
<h3 id="comparison">Comparison<a class="headerlink" href="#comparison" title="Permanent link">&para;</a></h3>
<p>The following tables compare feedbacks produced by the two pipelines developed in Y1M5 and in Y1Q3 respectively, in response to the same movement.
Corrrect feedbacks are highlighted.</p>
<ul>
<li><code>abduction-left</code></li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>Y1M5</th>
<th>Y1Q3</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Correct</strong></td>
<td><strong>1. You are moving very well!</strong><br> <strong>2. You are moving very well!</strong></td>
<td><strong>1. You are moving very well!</strong><br> <strong>2. You are moving very well!</strong></td>
</tr>
<tr>
<td><strong>Fast</strong></td>
<td>1.You are moving very well!<br> 2.You are moving very well!</td>
<td><strong>1. Move the left arm slower!</strong> <br> <strong>2. Move the left arm slower!</strong></td>
</tr>
<tr>
<td><strong>Slow</strong></td>
<td>1.You are moving very well!<br> 2.You are moving very well!</td>
<td>1. Move the left arm further up! <br> 2. Move the left arm further up!</td>
</tr>
<tr>
<td><strong>Low ROM</strong></td>
<td>1.You are moving very well!<br> 2.You are moving very well!</td>
<td><strong>1. Move the left arm further up!</strong> <br> <strong>2. Move the left arm further up!</strong></td>
</tr>
<tr>
<td><strong>Wrong</strong></td>
<td>1. You are doing the exercise correctly, but you could do it better. <br> 2. You are doing the exercise correctly, but you could do it better.</td>
<td><strong>1. You are doing the wrong exercise.</strong> <br> <strong>2. You are doing the wrong exercise.</strong></td>
</tr>
</tbody>
</table>
<ul>
<li><code>external-rotation-left</code></li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>Y1M5</th>
<th>Y1Q3</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Correct</strong></td>
<td>1. You are doing the exercise correctly, but you could do it better. <br> 2. You are doing the exercise correctly, but you could do it better.</td>
<td>1. Move the left arm slower! <br> <strong>2.You are moving very well!</strong></td>
</tr>
<tr>
<td><strong>Fast</strong></td>
<td>1.You are moving very well! <br> 2.You are moving very well!</td>
<td><strong>1.Move the left arm slower!</strong> <br> <strong>2.Move the left arm slower!</strong></td>
</tr>
<tr>
<td><strong>Slow</strong></td>
<td><strong>1. You are doing the exercise correctly, but you could do it better.</strong> <br> 2. You are moving very well!</td>
<td>1. You are moving very well! <br> <strong>2. Move the left arm faster!</strong></td>
</tr>
<tr>
<td><strong>Low ROM</strong></td>
<td>1.You are moving very well! <br> <strong>2. You are doing the exercise correctly, but you could do it better.</strong></td>
<td>1.You are moving very well! <br> 2.Move the left arm slower!</td>
</tr>
<tr>
<td><strong>Wrong</strong></td>
<td>1. You are doing the exercise correctly, but you could do it better. <br> 2. You are doing the exercise correctly, but you could do it better.</td>
<td><strong>1. You are doing the wrong exercise.</strong><br> <strong>2. You are doing the wrong exercise.</strong></td>
</tr>
</tbody>
</table>
<ul>
<li><code>internal-rotation-left</code></li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>Y1M5</th>
<th>Y1Q3</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Correct</strong></td>
<td><strong>1.You are moving very well!</strong> <br> <strong>2.You are moving very well!</strong></td>
<td><strong>1.You are moving very well!</strong> <br> <strong>2.You are moving very well!</strong></td>
</tr>
<tr>
<td><strong>Fast</strong></td>
<td>1.You are moving very well! <br> 2.You are moving very well!</td>
<td><strong>1.Move the left arm slower!</strong> <br> <strong>2.Move the left arm slower!</strong></td>
</tr>
<tr>
<td><strong>Slow</strong></td>
<td>1.You are moving very well! <br> 2.You are moving very well!</td>
<td>1.You are moving very well! <br> <strong>2.Move the left arm faster!</strong></td>
</tr>
<tr>
<td><strong>Low ROM</strong></td>
<td><strong>1.You are not moving very well!</strong> <br> <strong>2.You are not moving very well!</strong></td>
<td><strong>1. Move the left arm backwards!</strong> <br> <strong>2. Move the left arm backwards!</strong></td>
</tr>
<tr>
<td><strong>Wrong</strong></td>
<td><strong>1.You are not moving very well!</strong> <br> <strong>2.You are not moving very well!</strong></td>
<td><strong>1. You are doing the wrong exercise.</strong> <br>  <strong>2. You are doing the wrong exercise.</strong></td>
</tr>
</tbody>
</table>
<div class="admonition success">
<p class="admonition-title">Success</p>
<ul>
<li>in Y1Q3 the correct feedback is provided for <strong><em>fast</em></strong> movements, while in Y1M5 the feedback is always positive, regardless the speed;</li>
<li>in Y1Q3 the correct feedback is provided for <strong><em>low ROM</em></strong> movements, while in Y1M5 the feedback is always positive (except for the external rotation, which generates a medium score since there are time instants where the range of motion is below the minimum one);</li>
<li>in Y1Q3 a negative feedback is provided for <strong><em>wrong</em></strong> movements, while in Y1M5 the feedback is generated by a medium score, (except for the internal rotation, due to the static score, which is low as static joints deviate a lot from the resting position).</li>
</ul>
</div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<ul>
<li>in Y1Q3 a positive feedback is provided for <strong><em>slow</em></strong> movements. This occurs as the template skeleton moves slowly to emulate the movement shown by the robot and the feedback on the speed is triggered only by a very slow execution of the exercise;</li>
<li>in Y1Q3 a feedback on the speed is provided for an <strong><em>external rotation with low ROM</em></strong>, as the threshold on the frequency is set low to trigger also a feedback on slow movements.</li>
</ul>
</div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Y1Q3/" title="Y1Q3" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Y1Q3
              </span>
            </div>
          </a>
        
        
          <a href="../about/" title="About" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                About
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 Istituto Italiano di Tecnologia - iCub Facility
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>